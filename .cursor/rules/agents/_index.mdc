---
description: Multi-agent system overview for Cybersich Chat
alwaysApply: false
---
# AGENTS SYSTEM OVERVIEW

## Purpose

ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ³ĞµĞ½Ñ‚Ğ½Ğ° ĞµĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Cybersich Ğ· Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ¾Ñ Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ğ½Ğ½Ğ¸Ñ… Ğ³Ñ€Ğ°Ñ„Ñ–Ğ² Ñƒ FalkorDB. ĞĞ³ĞµĞ½Ñ‚Ğ¸ Ğ¿Ñ€Ğ°Ñ†ÑÑÑ‚ÑŒ Ñƒ Ñ€Ñ–Ğ·Ğ½Ğ¸Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°Ñ…: chat, development, analytics, ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½ÑƒÑÑ‡Ğ¸ÑÑŒ Ñ‡ĞµÑ€ĞµĞ· meta-orchestration Ğ³Ñ€Ğ°Ñ„.

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-GRAPH ECOSYSTEM                      â”‚
â”‚                    FalkorDB (Single Instance)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cybersich_chat â”‚  â”‚  cursor_memory    â”‚  â”‚researcher_analyticsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ meta_orchestration   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chat Pipeline (cybersich_chat graph)

```
User Message
    â†“
Entry Point (FastAPI)
    â†“
LangGraph Workflow
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ¸ÑĞ°Ñ€ÑŒ (Clerk)                     â”‚  Phase 1 âœ…
â”‚  - Ğ—Ğ°Ğ¿Ğ¸ÑÑƒÑ” Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ² Ğ³Ñ€Ğ°Ñ„      â”‚
â”‚  - Ğ‘Ğ•Ğ— Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ¸, Ğ‘Ğ•Ğ— Ñ€Ğ¾Ğ·Ğ´ÑƒĞ¼Ñ–Ğ²        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ (Subconscious)       â”‚  Phase 2 â³
â”‚  - ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ· Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ—      â”‚
â”‚  - Ğ¨ÑƒĞºĞ°Ñ” Ğ·Ğ²'ÑĞ·ĞºĞ¸ Ğ¼Ñ–Ğ¶ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½ÑĞ¼Ğ¸ â”‚
â”‚  - Ğ¤Ğ¾Ñ€Ğ¼ÑƒÑ” Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ (Orchestrator)         â”‚  Phase 3 â³
â”‚  - ĞŸÑ€Ğ¸Ğ¹Ğ¼Ğ°Ñ” Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ                  â”‚
â”‚  - Ğ“ĞµĞ½ĞµÑ€ÑƒÑ” Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ Ñ‡ĞµÑ€ĞµĞ· Gemini   â”‚
â”‚  - Ğ’Ğ¸ĞºĞ»Ğ¸ĞºĞ°Ñ” tools Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ñ–       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
    Response to User
```

### Development Pipeline (cursor_memory graph)

```
Developer Request (Cursor IDE)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞšÑƒÑ€ÑĞ¾Ñ€ (Cursor Agent)              â”‚  Phase 1 âœ…
â”‚  - Auto-record ĞºĞ¾Ğ¶ĞµĞ½ Ğ·Ğ°Ğ¿Ğ¸Ñ‚/Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒâ”‚
â”‚  - Track tools_used, files_modified â”‚
â”‚  - Link to DevelopmentSession       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
    Development Session History
    + Backup to Git
```

---

## Agent Modules

### Chat Pipeline (Multi-Agent System)

```
backend/app/agents/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ state.py           # Shared ChatState
â”œâ”€â”€ graph.py           # LangGraph workflow
â”‚
â”œâ”€â”€ clerk/             # Phase 1 âœ… Chat Flow
â”‚   â”œâ”€â”€ nodes.py
â”‚   â”œâ”€â”€ repository.py
â”‚   â””â”€â”€ schemas.py
â”‚
â”œâ”€â”€ subconscious/      # Phase 2 â³ Chat Flow
â”‚   â”œâ”€â”€ nodes.py
â”‚   â”œâ”€â”€ analyzer.py
â”‚   â””â”€â”€ schemas.py
â”‚
â””â”€â”€ orchestrator/      # Phase 3 â³ Chat Flow
    â”œâ”€â”€ nodes.py
    â”œâ”€â”€ router.py
    â””â”€â”€ schemas.py
```

â”œâ”€â”€ cursor/           # Phase 1 âœ… Development Agent
â”‚   â”œâ”€â”€ nodes.py
â”‚   â”œâ”€â”€ repository.py
â”‚   â””â”€â”€ schemas.py
â”‚
â””â”€â”€ orchestrator/     # Phase 3 â³ Chat Flow
    â”œâ”€â”€ nodes.py
    â”œâ”€â”€ router.py
    â””â”€â”€ schemas.py
```

### Standalone Agent (Not in Chat Flow)

```
backend/app/services/
â””â”€â”€ gemini_service.py  # Researcher (exists as GeminiService)
                       # Future: move to agents/researcher/
```

### Rules Files

**Ecosystem & Architecture:**
- **[agent-ecosystem.mdc](agent-ecosystem.mdc)** - Multi-Graph Architecture overview
- **[graph-management.mdc](graph-management.mdc)** - Managing multiple graphs

**Chat Pipeline (cybersich_chat graph):**
- **[langgraph-patterns.mdc](langgraph-patterns.mdc)** - Ğ—Ğ°Ğ³Ğ°Ğ»ÑŒĞ½Ñ– LangGraph patterns
- **[clerk.mdc](clerk.mdc)** - ĞŸĞ¸ÑĞ°Ñ€ÑŒ Agent (Phase 1)
- **[subconscious.mdc](subconscious.mdc)** - ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ Agent (Phase 2 - planning)
- **[orchestrator.mdc](orchestrator.mdc)** - ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Agent (Phase 3 - planning)

**Development Agent (cursor_memory graph):**
- **[cursor.mdc](cursor.mdc)** - Cursor Agent (Phase 1)

**Standalone (researcher_analytics graph):**
- **[researcher.mdc](researcher.mdc)** - Ğ”Ğ¾ÑĞ»Ñ–Ğ´Ğ½Ğ¸Ğº Agent (research playground)

---

## Shared State (ChatState)

**Location:** `backend/app/agents/state.py`

**Structure:**
```python
class ChatState(BaseModel):
    # Input
    message_content: str
    message_role: Literal["user", "assistant", "system"]
    session_id: str
    
    # Clerk outputs
    message_id: str | None
    recorded: bool
    
    # Subconscious outputs
    context: dict
    related_messages: list[str]
    
    # Orchestrator outputs
    action: str
    response: str | None
    
    # Error handling
    error: str | None
```

**CRITICAL:** ĞšĞ¾Ğ¶ĞµĞ½ Ğ°Ğ³ĞµĞ½Ñ‚ Ğ¼Ğ¾Ğ¶Ğµ Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚Ğ¸ Ğ½Ğ¾Ğ²Ñ– Ğ¿Ğ¾Ğ»Ñ, Ğ°Ğ»Ğµ ĞĞ• Ğ’Ğ˜Ğ”ĞĞ›Ğ¯Ğ¢Ğ˜ Ñ–ÑĞ½ÑƒÑÑ‡Ñ–.

---

## Agent Responsibilities

### Chat Pipeline Agents

#### ĞŸĞ¸ÑĞ°Ñ€ÑŒ (Clerk) - Phase 1 âœ…

**Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜:**
- âœ… Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ² FalkorDB
- âœ… Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ²ÑƒĞ·Ğ¾Ğ» (:Message)
- âœ… Ğ—Ğ²'ÑĞ·Ğ°Ñ‚Ğ¸ Ğ· (:ChatSession)

**Ğ—ĞĞ‘ĞĞ ĞĞĞ•ĞĞ:**
- âŒ ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
- âŒ ĞŸÑ€Ğ¸Ğ¹Ğ¼Ğ°Ñ‚Ğ¸ Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ
- âŒ ĞœĞ¾Ğ´Ğ¸Ñ„Ñ–ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ content
- âŒ Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ

#### ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ (Subconscious) - Phase 2 â³

**Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜:**
- âœ… Ğ§Ğ¸Ñ‚Ğ°Ñ‚Ğ¸ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ· Ğ³Ñ€Ğ°Ñ„Ğ°
- âœ… Ğ¨ÑƒĞºĞ°Ñ‚Ğ¸ ÑÑ…Ğ¾Ğ¶Ñ– Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ (semantic search)
- âœ… Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑĞ²Ğ°Ñ‚Ğ¸ Ğ·Ğ²'ÑĞ·ĞºĞ¸ Ğ¼Ñ–Ğ¶ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½ÑĞ¼Ğ¸
- âœ… Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°

**Ğ—ĞĞ‘ĞĞ ĞĞĞ•ĞĞ:**
- âŒ Ğ—Ğ°Ğ¿Ğ¸ÑÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ½Ğ¾Ğ²Ñ– Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ (Ñ†Ğµ Clerk)
- âŒ ĞŸÑ€Ğ¸Ğ¹Ğ¼Ğ°Ñ‚Ğ¸ Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ (Ñ†Ğµ Orchestrator)
- âŒ Ğ“ĞµĞ½ĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–

#### ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ (Orchestrator) - Phase 3 â³

**Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜:**
- âœ… ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ²Ñ–Ğ´ ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ¾ÑÑ‚Ñ–
- âœ… ĞŸÑ€Ğ¸Ğ¹Ğ¼Ğ°Ñ‚Ğ¸ Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ (respond, search, clarify, use_tool)
- âœ… Ğ“ĞµĞ½ĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ñ‡ĞµÑ€ĞµĞ· Gemini
- âœ… Ğ’Ğ¸ĞºĞ»Ğ¸ĞºĞ°Ñ‚Ğ¸ external tools

**Ğ—ĞĞ‘ĞĞ ĞĞĞ•ĞĞ:**
- âŒ ĞŸĞ¸ÑĞ°Ñ‚Ğ¸ Ğ² Ğ‘Ğ” Ğ½Ğ°Ğ¿Ñ€ÑĞ¼Ñƒ (Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· Clerk)
- âŒ Ğ Ğ¾Ğ±Ğ¸Ñ‚Ğ¸ context analysis (Ñ†Ğµ Subconscious)

---

### Development Agent

#### ĞšÑƒÑ€ÑĞ¾Ñ€ (Cursor Agent) - Phase 1 âœ…

**ĞŸĞ Ğ˜Ğ—ĞĞĞ§Ğ•ĞĞĞ¯:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ— Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ¸

**Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜:**
- âœ… Ğ—Ğ°Ğ¿Ğ¸ÑÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¶ĞµĞ½ UserQuery Ñ– AssistantResponse
- âœ… Ğ¢Ñ€ĞµĞºĞ°Ñ‚Ğ¸ tools_used Ñ‚Ğ° files_modified
- âœ… Ğ“Ñ€ÑƒĞ¿ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ¿Ğ¾ DevelopmentSession
- âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ backup Ğ² JSON + git

**Ğ—ĞĞ‘ĞĞ ĞĞĞ•ĞĞ:**
- âŒ ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ´ Ğ°Ğ±Ğ¾ Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ñ‚Ğ¸ Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ
- âŒ Ğ†Ğ½Ñ‚ĞµĞ³Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ÑÑŒ Ğ² chat flow (Ğ¾ĞºÑ€ĞµĞ¼Ğ¸Ğ¹ Ğ³Ñ€Ğ°Ñ„)
- âŒ ĞœĞ¾Ğ´Ğ¸Ñ„Ñ–ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ content Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²/Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ĞµĞ¹

**Graph:** `cursor_memory` (Ğ¾ĞºÑ€ĞµĞ¼Ğ¸Ğ¹ Ğ²Ñ–Ğ´ chat)

---

### Standalone Agent

#### Ğ”Ğ¾ÑĞ»Ñ–Ğ´Ğ½Ğ¸Ğº (Researcher) - Exists âœ…

**ĞŸĞ Ğ˜Ğ—ĞĞĞ§Ğ•ĞĞĞ¯:** Research playground Ğ´Ğ»Ñ ĞµĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ñ–Ğ² Ğ· Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼Ğ¸

**Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜:**
- âœ… Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ½ĞµÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚
- âœ… Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ€Ñ–Ğ·Ğ½Ñ– Ğ¼Ğ¾Ğ´ĞµĞ»Ñ– Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¸
- âœ… Ğ—Ğ±Ğ¸Ñ€Ğ°Ñ‚Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (ÑĞºÑ–ÑÑ‚ÑŒ, ÑˆĞ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ, Ğ²Ğ°Ñ€Ñ‚Ñ–ÑÑ‚ÑŒ)
- âœ… Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ‚Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·Ñƒ

**Ğ—ĞĞ‘ĞĞ ĞĞĞ•ĞĞ:**
- âŒ Ğ†Ğ½Ñ‚ĞµĞ³Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ÑÑŒ Ğ² chat flow (Ğ¾ĞºÑ€ĞµĞ¼Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ñ–Ñ)
- âŒ Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ²Ğ°Ñ‚Ğ¸ chat context
- âŒ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ° (Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ manual Ñ‡ĞµÑ€ĞµĞ· UI)

**NOTE:** ĞœĞ¾Ğ¶Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ tool Ğ´Ğ»Ñ Orchestrator Ğ² Ğ¼Ğ°Ğ¹Ğ±ÑƒÑ‚Ğ½ÑŒĞ¾Ğ¼Ñƒ, Ğ°Ğ»Ğµ Ñ†Ğµ Ğ¾Ğ¿Ñ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾.

---

## Cultural Context (ĞšĞ¾Ğ·Ğ°Ñ†ÑŒĞºĞ° ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ñ–Ñ)

### ĞĞ°Ğ·Ğ²Ğ¸ Ğ°Ğ³ĞµĞ½Ñ‚Ñ–Ğ²

**Chat Pipeline:**
- **ĞŸĞ¸ÑĞ°Ñ€ÑŒ (Clerk)** - ĞšĞ¾Ğ·Ğ°Ñ†ÑŒĞºĞ¸Ğ¹ Ğ¿Ğ¸ÑĞ°Ñ€, Ñ‰Ğ¾ Ğ²Ñ–Ğ² Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ¸ Ñ‚Ğ° Ñ…Ñ€Ğ¾Ğ½Ñ–ĞºĞ¸ Ğ¡Ñ–Ñ‡Ñ–
- **ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ (Subconscious)** - ĞšĞ¾Ğ»ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ° Ğ¿Ğ°Ğ¼'ÑÑ‚ÑŒ Ğ½Ğ°Ñ€Ğ¾Ğ´Ñƒ, Ğ·Ğ²'ÑĞ·ĞºĞ¸ Ğ¼Ñ–Ğ¶ Ğ¿Ğ¾Ğ´Ñ–ÑĞ¼Ğ¸
- **ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ (Orchestrator)** - ĞÑ‚Ğ°Ğ¼Ğ°Ğ½, Ñ‰Ğ¾ Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ñ” ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ñ–Ñ‡Ğ½Ñ– Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ

**Development:**
- **ĞšÑƒÑ€ÑĞ¾Ñ€ (Cursor)** - Ğ¥Ñ€Ğ¾Ğ½Ñ–ÑÑ‚ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ¸, Ñ‰Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ÑƒÑ” Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ– Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ Ñ‚Ğ° ĞµĞ²Ğ¾Ğ»ÑÑ†Ñ–Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñƒ

**Ğ’ĞĞ–Ğ›Ğ˜Ğ’Ğ:** Ğ¦Ñ– Ğ½Ğ°Ğ·Ğ²Ğ¸ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ– Ğ¼ĞµÑ‚Ğ°Ñ„Ğ¾Ñ€Ğ¸, Ğ° Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ– Ñ€Ğ¾Ğ»Ñ–:
- ĞŸĞ¸ÑĞ°Ñ€ Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒÑ” (Ğ½Ğµ Ñ–Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚ÑƒÑ”)
- ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ Ğ·Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¸ (Ğ½Ğµ Ğ²Ğ¸Ñ€Ñ–ÑˆÑƒÑ”)
- ĞÑ‚Ğ°Ğ¼Ğ°Ğ½ Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ñ” Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ (Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒÑ”)
- ĞšÑƒÑ€ÑĞ¾Ñ€ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ÑƒÑ” Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ (Ğ´Ğ»Ñ Ğ¼Ğ°Ğ¹Ğ±ÑƒÑ‚Ğ½Ñ–Ñ… Ğ¿Ğ¾ĞºĞ¾Ğ»Ñ–Ğ½ÑŒ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±Ğ½Ğ¸ĞºÑ–Ğ²)

---

## Communication Between Agents

### Through State Only

**ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:**
```python
# Clerk Ğ·Ğ°Ğ¿Ğ¸ÑÑƒÑ”
state["message_id"] = "abc123"
state["recorded"] = True

# Subconscious Ñ‡Ğ¸Ñ‚Ğ°Ñ”
message_id = state["message_id"]
# ... Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” ...
state["context"] = {...}

# Orchestrator Ñ‡Ğ¸Ñ‚Ğ°Ñ”
context = state["context"]
# ... Ğ¿Ñ€Ğ¸Ğ¹Ğ¼Ğ°Ñ” Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ ...
state["response"] = "..."
```

**ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:**
```python
# âŒ ĞŸÑ€ÑĞ¼Ñ– Ğ²Ğ¸ĞºĞ»Ğ¸ĞºĞ¸ Ğ¼Ñ–Ğ¶ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
clerk.create_message()  # Ğ— Subconscious
subconscious.analyze()  # Ğ— Orchestrator
```

**WHY:** LangGraph Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑ” immutable state flow, Ğ½Ğµ shared mutable objects.

---

## Testing Strategy

### Per-Agent Testing

**Unit tests:**
- `test_clerk_node.py` - Ñ‚ĞµÑÑ‚ÑƒÑ” Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ ĞŸĞ¸ÑĞ°Ñ€Ñ
- `test_subconscious_node.py` - Ñ‚ĞµÑÑ‚ÑƒÑ” Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ
- `test_orchestrator_node.py` - Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€

**Integration tests:**
- `test_workflow.py` - Ğ²ĞµÑÑŒ flow Ñ‡ĞµÑ€ĞµĞ· LangGraph

**Pattern:**
```python
# Mock Ğ¿Ğ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½Ñ– ÑÑ‚Ğ°Ğ½Ğ¸
initial_state = ChatState(
    message_content="test",
    message_role="user",
    session_id="test",
    # Subconscious outputs (ÑĞºÑ‰Ğ¾ Ñ‚ĞµÑÑ‚ÑƒÑ”Ğ¼Ğ¾ Orchestrator)
    context={"previous_topic": "history"},
    related_messages=["msg1", "msg2"]
)

result = await orchestrator_node(initial_state)
assert result.action == "respond"
```

---

## Error Handling

### Layer Separation

**Clerk errors:**
- DatabaseError - FalkorDB connection/query failed

**Subconscious errors:**
- AnalysisError - Embedding/similarity computation failed
- ContextError - Unable to build context

**Orchestrator errors:**
- DecisionError - Cannot decide action
- GenerationError - Gemini response failed

**API layer:**
Ğ’ÑÑ– Ğ¿ĞµÑ€ĞµÑ‚Ğ²Ğ¾Ñ€ÑÑÑ‚ÑŒÑÑ Ğ² HTTPException Ğ· proper status codes.

---

## Performance Considerations

### Async Execution

**ĞŸĞ¸ÑĞ°Ñ€ÑŒ:** Fast (~10-50ms)  
**ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ:** Medium (~100-500ms) - semantic search  
**ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€:** Slow (~1-5s) - Gemini API call

**Total per message:** ~1-5 seconds acceptable Ğ´Ğ»Ñ Phase 1-3.

### Optimization Opportunities (Phase 4+)

- **Parallel context retrieval** - asyncio.gather Ğ´Ğ»Ñ multiple queries
- **Caching** - Ñ‡Ğ°ÑÑ‚Ñ– Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ğ´Ğ¾ ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ¾ÑÑ‚Ñ–
- **Streaming** - Orchestrator ÑÑ‚Ñ€Ñ–Ğ¼Ğ¸Ñ‚ÑŒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ Ğ¿Ğ¾ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€ÑƒÑ”

---

## Configuration

### Agent-Specific Settings

```python
# core/config.py

class Settings(BaseSettings):
    # Clerk
    clerk_timeout: int = 5  # seconds
    
    # Subconscious  
    subconscious_max_related: int = 10  # max related messages
    subconscious_similarity_threshold: float = 0.7
    
    # Orchestrator
    orchestrator_timeout: int = 30  # Gemini can be slow
    orchestrator_default_action: str = "respond"
```

---

## Logging Strategy

### Per-Agent Prefixes

```python
logger.info("ğŸ“ ĞŸĞ¸ÑĞ°Ñ€ÑŒ: ĞŸĞ¾Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸Ñ...")
logger.info("ğŸ§  ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ: ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚...")
logger.info("ğŸ¯ ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€: ĞŸÑ€Ğ¸Ğ¹Ğ¼Ğ°Ñ Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ...")
```

**WHY:** Ğ›ĞµĞ³ĞºĞ¾ Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ Ğ°Ğ³ĞµĞ½Ñ‚Ñƒ.

---

## Development Workflow

### Adding New Agent

1. Create module: `backend/app/agents/{agent_name}/`
2. Implement node function
3. Add to LangGraph in `graph.py`
4. Create rules file: `.cursor/rules/agents/{agent_name}.mdc`
5. Update `_index.mdc` Ğ· Ğ½Ğ¾Ğ²Ğ¸Ğ¼ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ¼
6. Write tests
7. Document in session report

---

## Quick Reference

**Ecosystem & Architecture:**
- `agents/agent-ecosystem.mdc` - Multi-Graph Architecture overview
- `agents/graph-management.mdc` - Managing multiple graphs

**Chat Agents:**
- `agents/clerk.mdc` - ĞŸĞ¸ÑĞ°Ñ€ÑŒ Agent (Phase 1)
- `agents/subconscious.mdc` - ĞŸÑ–Ğ´ÑĞ²Ñ–Ğ´Ğ¾Ğ¼Ñ–ÑÑ‚ÑŒ Agent (Phase 2 - planning)
- `agents/orchestrator.mdc` - ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Agent (Phase 3 - planning)
- `agents/langgraph-patterns.mdc` - LangGraph workflow patterns

**Development Agents:**
- `agents/cursor.mdc` - Cursor Agent (Phase 1)

**Standalone:**
- `agents/researcher.mdc` - Ğ”Ğ¾ÑĞ»Ñ–Ğ´Ğ½Ğ¸Ğº Agent (research playground)

**System:**
- `agents/_index.mdc` - Ñ†ĞµĞ¹ Ñ„Ğ°Ğ¹Ğ» (overview Ğ²ÑÑ–Ñ”Ñ— ĞµĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸)

---

**Version:** 2.0.0  
**Created:** November 6, 2025  
**Updated:** November 12, 2025 (Multi-Graph Architecture + Cursor Agent)  
**Status:** Phase 1 complete, Phase 2 architecture ready
